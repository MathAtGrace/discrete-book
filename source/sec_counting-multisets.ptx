<?xml version="1.0" encoding="UTF-8"?>

<section xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="sec_counting-multisets">
  <title>Counting Multisets</title>
  <idx>
  <h>sticks and stones</h>
  </idx>
  <idx><h>multisets (counting)</h></idx>
  <idx><h>balls and bins</h><see>sticks and stones</see></idx>
  <idx><h>stars and bars</h><see>sticks and stones</see></idx>
  <idx>distribution (counting)</idx>

  <subsection xml:id="subsec_introduction">
    <title>Introduction</title>
    <investigation>
      <introduction>
        <p>
          Suppose you have some number of identical Rubik's cubes to distribute to your friends.  It might be helpful to picture these cubes in a row sitting in front of you.
        </p>
      </introduction>
      <task>
        <statement>
          <p>
            Say you have three cubes that you want to divide up between two of your friends.  Picture what you could do with the row of three cubes in front of you to accomplish this.  Write down the three distinct ways you could distribute the cubes.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            If you instead have four cubes to give to these two friends, how many outcomes are possible?  List them.
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            How many ways can you distribute <m>n</m> cubes to two friends?
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Repeat the above tasks, this time considering how to distribute the cubes to three friends.  You should write out some particular outcomes (if not all of them).
          </p>
        </statement>
      </task>
      <task>
        <statement>
          <p>
            Make a conjecture about how many different ways you could distribute 7 cubes to 4 people.
          </p>
        </statement>
      </task>
    </investigation>

    <p>
      Let's take stock of what sorts of counting questions we know how to answer.  
    </p>
    
    <example xml:id="eg-ice-cream">
      <statement>
        <p>
          Suppose an ice cream shop has 31 flavors.  After saving your allowance, you decide to splurge on a three-scoop ice cream treat.
          How many choices do you have?  And why are there at least three correct answers to this question?
        </p>
      </statement>
      <solution>
        <p>
          What the answer is depends on how we interpret the question.  We want to buy three scoops.  Do those scoops have to be all different flavors?  Are we getting a cone or a shake?  (Because perhaps we care about which scoop is on top in a cone, but in a shake, they will be blended up).
        </p>

        <p>
          Suppose first we want three distinct flavors in a cone.  Each option is then a <em>sequence</em> of <em>distinct</em> elements.  Some of these are:
          <ol>
            <li>
              <p>
                (Chocolate, Vanilla, Strawberry)
              </p>
            </li>
            <li>
              <p>
                (Vanilla, Strawberry, Chocolate)
              </p>
            </li>
            <li>
              <p>
                (Rocky road, Strawberry, Mint chocolate chip)
              </p>
            </li>
            <li>
              <p>
                etc.
              </p>
            </li>
          </ol>
          Since we are counting sequences, we use a permutation: <me>P(31,3) = 31\cdot 30 \cdot 29 = 26970</me>.
        </p>

        <p>
          If we wanted a shake with three distinct flavors, we need only specify which flavors are in our <em>set</em> of flavors, not the order/sequence they come in.  So we count subsets, which is done with a combination: <me>\binom{31}{3} = \frac{31\cdot 30\cdot 29}{3\cdot 2\cdot 1} = 4495</me>.  As we noticed previously, this will be <m>1/6</m> the number of sequences, since each set of three flavors corresponds to six sequences with those flavors.
        </p>

        <p>
          What if we allow repeated flavors?  For cones, we know how to answer this.  We are counting sequences of not-necessarily-distinct elements.  (Chocolate, Vanilla, Chocolate) is one outcome.  A separate one is (Chocolate, Chocolate, Vanilla).  We have 31 choices for each position, so our answer is <m>31^3</m>.
        </p>

        <p>
          Could we count how many shakes there are with repeat flavors allowed?  This would be like counting sets, but where we can include an element in the set more than once.  This is what we don't know how to do yet.
        </p>
      </solution>
    </example>

    <p>
      The goal of this section is to determine how to count unordered collections of elements, where we allow elements to occur more than once.  Such collections are called <term>multisets</term>.
    </p>

    <definition xml:id="def-multiset">
      <statement>
        <p>
          A <term>multiset</term> is an unordered collection of elements, where each element can occur a finite number of times.
        </p>

        <p>
          The number of times an element <m>x</m> occurs in a multiset is called the <term>multiplicity</term> of <m>x</m>.  
        </p>
      </statement>
    </definition>

    <p>
      We use squiggly braces for multisets, just like sets.  So we might have the multiset <m>\{1,1,3,4\}</m>, which is the same multiset as <m>\{1,3,1,4\}</m>: they are both a collection containing two instances of 1, and single instances of 3 and 4.  The <term>size</term> or <term>cardinality</term> of this multiset is 4; we count each occurrence of each element. (As <em>sets</em>, both of these are identical to the set <m>\{1,3,4\}</m>.) 
    </p>

    <p>
      When we started counting the number of sets in <xref ref="sec_counting-binom"/>, we gave the number of <m>k</m>-element subsets of a set of size <m>n</m> a name: <m>n</m> choose <m>k</m>, written <m>\binom{n}{k}</m>.  We can do that for multisets as well.
    </p>

    <definition xml:id="def-multichoose">
      <statement>
        <p>
          The number of multisets of size <m>k</m> with elements chosen from a set of size <m>n</m> is <m>n</m> <term>multichoose</term> <m>k</m>, written,
          <me>
            \mchoose{n}{k}
          </me>. 
        </p>
      </statement>
    </definition>

    <p>
      Returning to <xref ref="eg-ice-cream"/>, we can now say the number of shakes you can make using three scoops of ice cream, possibly repeating flavors, when you have 31 flavors to choose from is
      <me>
        \mchoose{31}{3}
      </me>.
      Of course, we want to determine a way to compute the numerical value of this expression.
    </p>

    </subsection>
    <subsection xml:id="subsec-giving-cookies-to-kids">
      <title>Giving cookies to kids</title>
      
    <p>
      It turns out that thinking about a related counting problem will be helpful in this quest.  Consider the following:
    </p>

    <blockquote>
      <p>
        You have 7 cookies to give to 4 kids.
        How many ways can you do this?
      </p>
    </blockquote>

    <p>
      Assume that it is acceptable to give a kid no cookies.
      Also, the cookies are all identical and the order in which you give out the cookies does not matter.
    </p>

    <p>
      First, what's wrong with the answer <m>4^7</m>?  Well, that counts the number of sequences of length seven where each term in the sequence is chosen from a set of size four: four choices for the first term, four for the second, and so on.  In our problem, we have four kids and seven cookies.  Is one outcome <m>(A,A,B,A,D,C,D)</m>?  That is, we give the first cookie to kid <m>A</m>, the second to kid <m>A</m>, the third to kid <m>B</m>, and so on? 
    </p>

    <p>
      That actually looks promising.  But by considering a sequence, we are claiming that a <me>different</me> outcome is <m>(A,A,A,B,C,D,D)</m>.  Of course, this is the same result: three cookies for <m>A</m>, one for <m>B</m> and <m>C</m>, and two for <m>D</m>.
    </p>

    <p>
      This does suggest though that what we are actually after is a multiset: <m>\{A, A, A, B, C, D, D\}</m>.  Since any order of these seven occurrences is the same outcome, it is indeed a set-like structure we want, rather than sequence-like. We therefore know that the answer to our question will be <me>\mchoose{7}{4}</me>.
    </p>

    <p>
      Let's consider a different way to represent this outcome.  All we really need to do is say when to switch from one letter to the next (we might as well assume the letters come in alphabetical order).
      In terms of cookies,
      we need to say after how many cookies do we stop giving cookies to the first kid and start giving
      cookies to the second kid.
      And then after how many do we switch to the third kid?
      And after how many do we switch to the fourth?
      So another way to represent an outcome is like this:
      <me>
        ○○○|○|○|○○
      </me>.
    </p>

    <p>
      Three cookies go to the first kid,
      then we switch and give one cookie to the second kid, then switch,
      one to the third kid, switch, two to the fourth kid.
      Notice that we need seven cookie symbols and three (not four) switching symbols
      (we don't need to switch after the last kid).
    </p>

    <p>
      Why have we done all of this?
      Simple: to count the number of ways to distribute 7 cookies to 4 kids,
      all we need to do is count how many strings of this type there are.  We will call such a string a <term>sticks and stones chart</term>
      <idx><h>sticks and stones</h><h>chart</h></idx>.  They are just strings of two symbols, some sticks and some stones.
      If instead of sticks and stones we would use 1's and 0's, it would just be a bit string.
      <idx><h>bit string</h><h>relation to sticks and stones</h></idx>
      We know how to count those!
    </p>

    <p>
      Before we get too excited, we should make sure that really
      <em>any</em>
      string of (in our case) 7 stones and 3 sticks corresponds to a different way to distribute cookies to kids.
      Consider a string like this:
      <me>
        |○○○||○○○○
      </me>.
    </p>

    <p>
      Does that correspond to a cookie distribution?
      Yes.
      It represents the distribution in which kid <m>A</m> gets 0 cookies
      (because we switch to kid <m>B</m> before any stones),
      kid <m>B</m> gets three cookies
      (three stones before the next stick),
      kid <m>C</m> gets 0 cookies
      (no stones
      before the next bar)
      and kid <m>D</m> gets the remaining 4 cookies.
      No matter how the sticks and stones are arranged,
      we can distribute cookies in that way.
      Also, given any way to distribute cookies,
      we can represent that with a sticks and stones chart.
      For example, the distribution in which kid <m>A</m> gets 6 cookies and kid <m>B</m> gets 1 cookie has the following chart:
      <me>
        ○○○○○○|○||
      </me>.
    </p>

    <p>
      After all this work we are finally ready to count.
      Each way to distribute cookies corresponds to a sticks and stones chart with 7 stones and 3 sticks.
      So there are 10 symbols, and we must choose 7 of them to be stones.
      Thus there are <m>\binom{10}{7}</m>  ways to distribute 7 cookies to 4 kids.
    </p>


    <p>
      While we are thinking about cookies, we can also answer a related question:
      how many ways are there to distribute 7 cookies to 4 kids so that each kid gets at least one cookie?
      What can you say about the corresponding sticks and stones charts?
      The charts must start and
      end with at least one star
      (so that kids A and D)
      get cookies, and also no two sticks can be adjacent
      (so that kids B and C are not skipped).
      One way to assure this is to place sticks only in the spaces
      <em>between</em>
      the stones.
      With 7 stones, there are 6 spots between the stones,
      so we must choose 3 of those 6 spots to fill with bars.
      Thus there are
      <m>{6 \choose 3}</m>
      ways to distribute 7 cookies to 4 kids giving at least one cookie to each kid.
    </p>

    <p>
      Another (and more general) way to approach this modified problem is to first give each kid one cookie.
      Now the remaining 3 cookies can be distributed to the 4 kids without restrictions.
      So we have 3 stones and 3 sticks for a total of 6 symbols, 3 of
      which must be bars.
      So again we see that there are
      <m>{6 \choose 3}</m>
      ways to distribute the cookies.
    </p>

    </subsection>

    <subsection xml:id="subsec-more-sticks-and-stones">
      <title>More Sticks and Stones</title>
      
    <p>
      Sticks and stones can be used in counting problems other than kids and cookies.
      Here are a few examples:
    </p>

    <example xml:id="eg-sticks-stones-ice-cream">
      <idx>distribution (counting)</idx>
      <statement>
        <p>
          Your favorite mathematical ice-cream parlor offers 10 flavors.
          How many milkshakes could you create using exactly 6, not necessarily distinct scoops?
          The order you add the flavors does not matter (they will be blended up anyway) but you are allowed repeats.
          So one possible shake is triple chocolate, double cherry,
          and mint chocolate chip.
        </p>
      </statement>
      <solution>
        <p>
          We get six scoops, each of which could be one of ten possible flavors.
          Represent each scoop as a star.
          Think of going down the counter one flavor at a time:
          you see vanilla first, and skip to the next, chocolate.
          You say yes to chocolate three times (use three stones), then
          switch to the next flavor.
          You keep skipping until you get to cherry,
          which you say yes to twice.
          Another switch and you are at mint chocolate chip.
          You say yes once.
          Then you keep switching until you get past the last flavor,
          never saying yes
          again (since you already have said yes six times).
          There are ten flavors to choose from,
          so we must switch from considering one flavor to the next nine times.
          These are the nine sticks.
        </p>

        <p>
          Now that we are confident that we have the right number of sticks and stones,
          we answer the question simply:
          there are 6 stones and 9 sticks, so 15 symbols.
          We need to pick 6 of them to be stones,
          so the number of milkshakes possible is
          <me>
            \binom{15}{6}
          </me>.
        </p>
      </solution>
    </example>

    <example xml:id="eg-sticks-stones-phone-number">
      <statement>
        <p>
          How many 7-digit phone numbers are there in which the digits are non-increasing?
          That is, every digit is less than or equal to the previous one.
        </p>
      </statement>
      <solution>
        <p>
          We need to decide on 7 digits so we will use 7 stones.
          The sticks will represent a switch from each possible single digit number down to the next smaller one.
          So the phone number 866-5221 is represented by the sticks and stones chart
          <me>
            |○||○○|○|||○○|○|
          </me>.
        </p>

        <p>
          There are 10 choices for each digit (0-9) so we must switch between choices 9 times.
          We have 7 stones and 9 sticks, so the total number of phone numbers is
          <me>
            \binom{16}{7}
          </me>.
        </p>
      </solution>
    </example>

    <example xml:id="example-multisets-int-sol">
      <idx>integer solutions to equation (counting)</idx>
      <statement>
        <p>
          How many integer solutions are there to the equation
          <me>
            x_1 + x_2 + x_3 + x_4 + x_5 = 13
          </me>.
        </p>

        <p>
          (An <term>integer solution</term>
          to an equation is a solution in which the unknown must have an integer value.)
        </p>

        <p>
          <ol>
            <li>
              <p>
                where
                <m>x_i \ge 0</m>
                for each
                <m>x_i</m>?
              </p>
            </li>

            <li>
              <p>
                where
                <m>x_i &gt; 0</m>
                for each
                <m>x_i</m>?
              </p>
            </li>

            <li>
              <p>
                where
                <m>x_i \ge 2</m>
                for each
                <m>x_i</m>?
              </p>
            </li>
          </ol>
        </p>
      </statement>
      <solution>
        <p>
          This problem is just like giving 13 cookies to 5 kids.
          We need to say how many of the 13 units go to each of the 5 variables.
          In other words, we have 13 stones and 4 sticks
          (the sticks are like the
          <q>+</q>
          signs in the equation).
        </p>

        <p>
          <ol>
            <li>
              <p>
                If
                <m>x_i</m>
                can be 0 or greater, we are in the standard case with no restrictions.
                So 13 stones and 4 sticks can be arranged in
                <m>\binom{17}{13}</m>
                ways.
              </p>
            </li>

            <li>
              <p>
                Now each variable must be at least 1.
                So give one unit to each variable to satisfy that restriction.
                Now there are 8 stones left, and still 4 sticks,
                so the number of solutions is
                <m>\binom{12}{8}</m>.
              </p>
            </li>

            <li>
              <p>
                Now each variable must be 2 or greater.
                So before any counting, give each variable 2 units.
                We now have 3 remaining stones and 4 sticks, so there are
                <m>\binom{7}{3}</m>
                solutions.
              </p>
            </li>
          </ol>
        </p>
      </solution>
    </example>

    <paragraphs>
      <title>Counting with Functions</title>
      <idx><h>function</h><h>counting</h></idx>
      <p>
        Many of the counting problems in this section might at first appear to be examples of counting
        <em>functions</em>.
        After all, when we try to count the number of ways to distribute cookies to kids,
        we are assigning each cookie to a kid,
        just like you assign elements of the domain of a function to elements in the codomain.
        However, the number of
        ways to assign 7 cookies to 4 kids is
        <m>\binom{10}{7} = 120</m>, while the number of functions
        <m>f: \{1,2,3,4,5,6,7\} \to \{a,b,c,d\}</m>
        is
        <m>4^7 = 16384</m>.
        What is going on here?
      </p>

      <p>
        When we count functions,
        we consider the following two functions,
        for example, to be different:
        <me>
          f = \twoline{1 \amp 2 \amp 3 \amp 4\amp 5 \amp 6 \amp 7}{a \amp b \amp c \amp c \amp c \amp c \amp c} \qquad g = \twoline{1 \amp 2 \amp 3 \amp 4\amp 5 \amp 6 \amp 7}{b \amp a \amp c \amp c \amp c \amp c \amp c}
        </me>.
        But these two functions would correspond to the
        <em>same</em>
        cookie distribution: kids
        <m>a</m>
        and
        <m>b</m>
        each get one cookie, kid
        <m>c</m>
        gets the rest
        (and none for kid
        <m>d</m>).
      </p>

      <p>
        The point: elements of the domain are distinguished,
        cookies are indistinguishable.
        This is analogous to the distinction between permutations
        (like counting functions)
        and combinations
        (not).
      </p>
    </paragraphs>
  </subsection>

  <subsection xml:id="subsec-multichoose-formula">
    <title>A formula for multichoose</title>
    <p>
      When solving the examples above, we went directly from the counting problem to the sticks and stones representations.  We could have also determined what multisets we are counting.  Let's do that.
    </p>  

    <p>
      <ol>
        <li>
          <p>
            The number of ways to distribute seven cookies to four kids is <m>\binom{10}{7}</m>, representing outcomes with 3 sticks and 7 stones.  Each distribution is also a length 7 multiset with element chosen from a set of size 4.  Thus the number of outcomes is 
            <me>
              \mchoose{4}{7} = \binom{10}{7}
            </me>.
          </p>
        </li>
        <li>
          <p>
            The number of 6-scoop shakes choosing from 10 flavors, as in <xref ref="eg-sticks-stones-ice-cream"/> is <m>\binom{15}{6}</m>, representing outcomes as strings of 9 sticks and 6 stones.  We can also represent each outcome as a 6-element multiset with elements chosen from a set of 10 flavors, so we have that <me>\mchoose{10}{6} = \binom{15}{6}</me>.
          </p>
        </li>
        <li>
          <p>
            The number of 7-digit phone numbers with digits non-increasing is <m>\binom{16}{7}</m>, representing outcomes as strings of 9 sticks and 7 stones, as in <xref ref="eg-sticks-stones-phone-number"/>.  But we can represent each outcome as a multiset of size 7, with element chosen from the 10 digits 0-9.  Thus <me>\mchoose{10}{7} = \binom{16}{7}</me>.
          </p>
        </li>
        <li>
          <p>
            The number of non-negative integer solutions to the equation <m>x_1 + x_2 + x_3 + x_4 + x_5 = 13</m>, as in <xref ref="example-multisets-int-sol"/>, is <m>\binom{17}{13}</m>.  Each outcome can also be represented as a multiset of size 13 with elements chosen from <m>\{x_1, x_2, \ldots, x_5\}</m>.  Thus we have <me>\mchoose{5}{13} = \binom{17}{13}</me>.
          </p>
        </li>
      </ol>
    </p>

    <p>
      In general, if we want a multiset of size <m>k</m> with element chosen from a set of size <m>n</m>, we can create a sticks and stones chart in which each stone represents us choosing one of the <m>k</m> spots in the multiset, and each stick representing a switch to the next of the <m>n</m> different options for that spot.  There are then <m>k</m> stones and <m>n-1</m> sticks, for a total of <m>n+k-1</m> symbols, <m>k</m> of which are stones.  Therefore we get:
    </p>

    <theorem xml:id="thm-multichoose">
      <statement>
        <p>
          The number of <m>k</m>-element multisets with elements chosen from a set of size <m>n</m> is <me>\mchoose{n}{k} = \binom{n+k-1}{k}</me>.
        </p>
      </statement>
    </theorem>
    
  </subsection>

  <reading-questions xml:id="rqs-counting-multisets">

    <exercise label="rq-counting-multisets-nonex">
      <statement>
        <p> 
          Which of the following counting questions are NOT an example of a question you would use sticks and stones to solve?
        </p>
      </statement>
      <choices randomize="yes">
        <choice correct="yes">
          <statement>
            <p>
              How many ways can you distribute six unique gifts to three friends?
            </p>
          </statement>
          <feedback>
            <p>
              Correct.  Because the gifts are distinct, we have three choices for the first gift, three for the second, etc, making the answer <m>3^6</m>.
            </p>
          </feedback>
        </choice>
        <choice>
          <statement>
            <p>
              How many ways can you distribute six identical gifts to three friends?
            </p>
          </statement>
          <feedback>
            <p>
              You can use sticks and stones here: use two sticks to separate your three friends, and use six stones for the gifts.
            </p>
          </feedback>
        </choice>
        <choice>
          <statement>
            <p>
              How many different combinations of numbers can you get if you roll three identical 6-side dice?
            </p>
          </statement>
          <feedback>
            <p>
              Use five sticks to separate the six values on the dice.  Each stone represents one of the identical dice.
            </p>
          </feedback>
        </choice>
        <choice>
          <statement>
            <p>
              How many different three-scoop milkshakes can you make when each scoop of ice-cream can be one of six different flavors?
            </p>
          </statement>
          <feedback>
            <p>
              Use five sticks and three stones!
            </p>
          </feedback>
        </choice>
      </choices>
    </exercise>
    <exercise label="rq-counting-multisets-order-repeats">
      <statement>
        <p>
          When you count outcomes using sticks and stones, does order matter?  Do you allow repeats?  What do you mean by your answers (the order of what, the repeat of what)?
        </p>
      </statement>
      <response/>
    </exercise>
    <exercise label="rq-counting-multisets-q" component="runestone">
      <statement>
        <p> What questions do you have after reading this section? Write at
          least one question about the content of this section that we could answer in class or
          online. 
        </p>
      </statement>
      <response />
    </exercise>
  </reading-questions>
  <xi:include href="practice/counting-multisets.ptx"/>
  <xi:include href="exercises/counting-multisets.ptx"/>
</section>

