<?xml version="1.0" encoding="UTF-8"?>

<section xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="sec_counting-repeats">
  <title>Counting with Repeats</title>


  <subsection xml:id="subsec_PIE">
    <title>Principle of Inclusion/Exclusion</title>
    <idx><h>principle of inclusion/exclusion</h></idx>
    <idx><h>PIE</h><see>principle of inclusion/exclusion</see></idx>
    <idx><h>inclusion/exclusion</h><see>principle of inclusion/exclusion</see></idx>
    <investigation>
      <p>
        A recent buzz marketing campaign for <em>Village Inn</em>
        surveyed patrons on their pie preferences.
        People were asked whether they enjoyed (A) Apple, (B) Blueberry or (C) Cherry pie
        (respondents answered yes or no to each type of pie,
        and could say yes to more than one type).
        The following table shows the results of the survey.
      </p>

      <sidebyside>

        <tabular halign="center">
          <row bottom="minor">
            <cell right="minor" halign="right">Pies enjoyed:</cell>
            <cell>A</cell>
            <cell>B</cell>
            <cell>C</cell>
            <cell>AB</cell>
            <cell>AC</cell>
            <cell>BC</cell>
            <cell>ABC</cell>
          </row>
          <row>
            <cell right="minor" halign="right">Number of people:</cell>
            <cell>20</cell>
            <cell>13</cell>
            <cell>26</cell>
            <cell>9</cell>
            <cell>15</cell>
            <cell>7</cell>
            <cell>5</cell>
          </row>
        </tabular>

      </sidebyside>

      <p>
        How many of those asked enjoy at least one of the kinds of pie?
        Also, explain why the answer is not 95.
      </p>
    </investigation>
    <p>
          <idx><h>Venn diagram</h><h>for counting</h></idx>
      While we are thinking about sets,
      consider what happens to the sum principle when the sets are NOT disjoint.
      Suppose we want to find <m>\card{A \cup B}</m> and know that
      <m>\card{A} = 10</m> and <m>\card{B} = 8</m>.
      This is not enough information though.
      We do not know how many of the 8 elements in <m>B</m> are also elements of <m>A</m>.
      However, if we also know that <m>\card{A \cap B} = 6</m>,
      then we can say exactly how many elements are in <m>A</m>, and,
      of those,
      how many are in <m>B</m> and how many are not (6 of the 10 elements are in <m>B</m>,
      so 4 are in <m>A</m> but not in <m>B</m>).
      We could fill in a Venn diagram 
      as follows:
    </p>

    <sidebyside width="40%">

      <image>

        <latex-image>
          \begin{tikzpicture}
     \draw[thick] \circleA \circleAlabel \circleB \circleBlabel \twosetbox;
     \draw (0,0) node{6} (-1,0) node{4} (1,0) node{2};
   \end{tikzpicture}
        </latex-image>
        <description>Intersecting circles labeled A and B.  Inside the region enclosed by both circles is the number 6.  The number 4 is in the region inside A but outside B.  The number 2 is in the region inside B but outside A.</description>
      </image>

    </sidebyside>

    <p>
      This says there are 6 elements in <m>A \cap B</m>, 4 elements in
      <m>A \setminus B</m> and 2 elements in <m>B \setminus A</m>.
      Now <em>these</em> three sets <em>are</em> disjoint,
      so we can use the sum principle to find the number of elements in <m>A \cup B</m>.
      It is <m>6 + 4 + 2 = 12</m>.
    </p>

    <p>
      This will always work,
      but drawing a Venn diagram is more than we need to do.
      In fact, it would be nice to relate this problem to the case where <m>A</m> and <m>B</m> are disjoint.
      Is there one rule we can make that works in either case?
    </p>

    <p>
      Here is another way to get the answer to the problem above.
      Start by just adding <m>\card{A} + \card{B}</m>.
      This is <m>10 + 8 = 18</m>,
      which would be the answer if <m>\card{A \cap B} = 0</m>.
      We see that we are off by exactly 6, which just so happens to be <m>\card{A \cap B}</m>.
      So perhaps we guess,
      <me>
        \card{A \cup B} = \card{A} + \card{B} - \card{A \cap B}
      </me>.
    </p>

    <p>
      This works for this one example.
      Will it always work?
      Think about what we are doing here.
      We want to know how many things are either in <m>A</m> or <m>B</m>
      (or both).
      We can throw in everything in <m>A</m>,
      and everything in <m>B</m>.
      This would give <m>\card{A} + \card{B}</m> many elements.
      But of course when you actually take the union,
      you do not repeat elements that are in both.
      So far we have counted every element in <m>A \cap B</m> exactly twice:
      once when we put in the elements from <m>A</m> and once when we included the elements from <m>B</m>.
      We correct by subtracting out the number of elements we have counted twice.
      So we added them in twice,
      subtracted once, leaving them counted only one time.
    </p>

    <p>
      In other words, we have:
    </p>

    <assemblage>
      <title>Cardinality of a union (2 sets)</title>
      <idx><h>principle of inclusion/exclusion</h><h>for 2 sets</h></idx>
      <idx><h>cardinality</h><h>of a union</h></idx>
      <p>
        For any finite sets <m>A</m> and <m>B</m>,
        <me>
          \card{A \cup B} = \card{A} + \card{B} - \card{A \cap B}
        </me>.
      </p>
    </assemblage>

    <p>
      We can do something similar with three sets.
    </p>

    <example>
      <statement>
        <p>
          An examination in three subjects, Algebra, Biology,
          and Chemistry, was taken by 41 students.
          The following table shows how many students failed in each single subject and in their various combinations:
        </p>

        <sidebyside>

          <tabular halign="center">
            <row bottom="minor">
              <cell right="minor" halign="right">Subject:</cell>
              <cell>A</cell>
              <cell>B</cell>
              <cell>C</cell>
              <cell>AB</cell>
              <cell>AC</cell>
              <cell>BC</cell>
              <cell>ABC</cell>
            </row>
            <row>
              <cell right="minor" halign="right">Failed:</cell>
              <cell>12</cell>
              <cell>5</cell>
              <cell>8</cell>
              <cell>2</cell>
              <cell>6</cell>
              <cell>3</cell>
              <cell>1</cell>
            </row>
          </tabular>

        </sidebyside>

        <p>
          How many students failed at least one subject?
        </p>
      </statement>
      <solution>
        <p>
          The answer is not 37, even though the sum of the numbers above is 37.
          For example,
          while 12 students failed Algebra, 2 of those students also failed Biology, 6 also failed Chemistry,
          and 1 of those failed all three subjects.
          In fact, that 1 student who failed all three subjects is counted a total of 7 times in the total 37.
          To clarify things,
          let us think of the students who failed Algebra as the elements of the set <m>A</m>,
          and similarly for sets <m>B</m> and <m>C</m>.
          The one student who failed all three subjects is the lone element of the set <m>A \cap B \cap C</m>.
          Thus, in Venn diagrams:
        </p>

        <sidebyside width="36%">

          <image>

            <latex-image>
              \begin{tikzpicture}[scale=0.9]
     \draw[thick] \circleA \circleAlabel \circleB \circleBlabel \circleC \circleClabel \threesetbox;
     \draw (0,-.35) node{1};
   \end{tikzpicture}
            </latex-image>
            <description>
              Three intersecting circles labeled A, B, and C.  The center region inside all three circles contains the number 1.
            </description>
          </image>

        </sidebyside>

        <p>
          Now let's fill in the other intersections.
          We know <m>A\cap B</m> contains 2 elements,
          but 1 element has already been counted.
          So we should put a 1 in the region where <m>A</m> and <m>B</m> intersect
          (but <m>C</m> does not).
          Similarly, we calculate the cardinality of <m>(A\cap C) \setminus B</m>,
          and <m>(B \cap C) \setminus A</m>:
        </p>

        <sidebyside width="36%">

          <image>

            <latex-image>
              \begin{tikzpicture}[scale=0.9]
     \draw[thick] \circleA \circleAlabel \circleB \circleBlabel \circleC \circleClabel \threesetbox;
     \draw (0,-.35) node{1} (0,.4) node{1} (-.6,-.65) node{5} (.6,-.65) node{2};
   \end{tikzpicture}
            </latex-image>
              <description>
              Three intersecting circles labeled A, B, and C.  The center region inside all three circles contains the number 1.  The region above this, inside both A and B but outside C, contains the number 1.  The region inside both A and C but outside B contains the number 5.  The region inside B and C but outside A contains the number 2.
            </description>
          </image>

        </sidebyside>

        <p>
          Next, we determine the numbers which should go in the remaining regions,
          including outside of all three circles.
          This last number is the number of students who did not fail any subject:
        </p>

        <sidebyside width="36%">

          <image>

            <latex-image>
              \begin{tikzpicture}[scale=0.9]
     \draw[thick] \circleA \circleAlabel \circleB \circleBlabel \circleC \circleClabel \threesetbox;
     \draw (0,-.35) node{1} (0,.4) node{1} (-.6,-.65) node{5} (.6,-.65) node{2};
     \draw (-1,.3) node{5} (1,.3) node{1} (0,-1.5) node{0} (-1.5,-1.75) node{26};
   \end{tikzpicture}
            </latex-image>
            <description>
              Three intersecting circles labeled A, B, and C.  The center region inside all three circles contains the number 1.  The region above this, inside both A and B but outside C, contains the number 1.  The region inside both A and C but outside B contains the number 5.  The region inside B and C but outside A contains the number 2.  The region just inside A contains the number 5; the region just inside B contains the number 1; the region just inside C contains the number 0.  The number 26 is outside all three circles.
            </description>
          </image>

        </sidebyside>

        <p>
          We found 5 goes in the <q><m>A</m> only</q>
          region because the entire circle for <m>A</m> needed to have a total of 12,
          and 7 were already accounted for.
          Similarly, we calculate the <q><m>B</m> only</q>
          region to contain only 1 student and the <q><m>C</m> only</q>
          region to contain no students.
        </p>

        <p>
          Thus the number of students who failed at least one class is 15
          (the sum of the numbers in each of the eight disjoint regions).
          The number of students who passed all three classes is 26:
          the total number of students, 41,
          less the 15 who failed at least one class.
        </p>

        <p>
          Note that we can also answer other questions.
          For example, how many students failed just Chemistry?
          None.
          How many passed Algebra but failed both Biology and Chemistry?
          This corresponds to the region inside both <m>B</m> and <m>C</m> but outside of <m>A</m>,
          containing 2 students.
        </p>
      </solution>
    </example>

    <p>
      Could we have solved the problem above in an algebraic way?
      While the sum principle generalizes to any number of sets,
      when we add a third set here, we must be careful.
      With two sets,
      we needed to know the cardinalities of <m>A</m>, <m>B</m>,
      and <m>A \cap B</m> in order to find the cardinality of <m>A \cup B</m>.
      With three sets we need more information.
      There are more ways the sets can combine.
      Not surprisingly then,
      the formula for cardinality of the union of three non-disjoint sets is more complicated:
    </p>

    <assemblage>
      <title>Cardinality of a union (3 sets)</title>
      <idx>
        <h>principle of inclusion/exclusion</h>
        <h>for 3 sets</h>
      </idx>
      <idx>
        <h>cardinality</h>
        <h>of a union</h>
      </idx>
      <p>
        For any finite sets <m>A</m>, <m>B</m>, and <m>C</m>,
        <md>
          <mrow>\card{A \cup B \cup C} = \amp \card{A} + \card{B} + \card{C} </mrow>
            <mrow> - \amp \card{A \cap B} - \card{A \cap C} - \card{B \cap C} </mrow> 
            <mrow> + \amp \card{A \cap B \cap C} </mrow>
        </md>.
      </p>
    </assemblage>

    <p>
      To determine how many elements are in at least one of <m>A</m>,
      <m>B</m>,
      or <m>C</m> we add up all the elements in each of those sets.
      However, when we do that,
      any element in both <m>A</m> and <m>B</m> is counted twice.
      Also, each element in both <m>A</m> and <m>C</m> is counted twice,
      as are elements in <m>B</m> and <m>C</m>,
      so we take each of those out of our sum once.
      But now what about the elements which are in <m>A \cap B \cap C</m> (in all three sets)?
      We added them in three times,
      but also removed them three times.
      They have not yet been counted.
      Thus we add those elements back in at the end.
    </p>

    <p>
      Returning to our example above,
      we have <m>\card{A} = 12</m>,
      <m>\card{B} = 5</m>, <m>\card{C} = 8</m>.
      We also have <m>\card{A \cap B} = 2</m>,
      <m>\card{A \cap C} = 6</m>,
      <m>\card{B \cap C} = 3</m>, and <m>\card{A \cap B \cap C} = 1</m>.
      Therefore:
      <me>
        \card{A \cup B \cup C} = 12 + 5 + 8 - 2 - 6 - 3 + 1 = 15
      </me>.
    </p>

    <p>
      This is what we got when we solved the problem using Venn diagrams.
    </p>

    <p>
      This process of adding in, then taking out, then adding back in,
      and so on is called the <em>Principle of Inclusion/Exclusion</em>,
      or simply PIE. We will return to this counting technique later to solve for more complicated problems
      (involving more than 3 sets).
    </p>
  </subsection>

  <reading-questions xml:id="rqs-counting-addmult">
   
    <exercise label="rq-counting-repeats-q" component="runestone">
      <statement>
        <p> What questions do you have after reading this section? Write at least one question about
          the content of this section that we could answer in class or online. <m>.</m>
        </p>
      </statement>
      <response />
    </exercise>
  </reading-questions>

  <xi:include href="practice/counting-repeats.ptx"/>
  <xi:include href="exercises/counting-repeats.ptx"/>
</section>

